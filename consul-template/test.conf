#WARNING! this config file is automatic generated by consule-tamplate. any changes here will not persistence!

#===========================================================
#========== Upstream in DataCenter(core.ecoho.cn) ==========
#===========================================================

#========== Service Node ==========
           
###Upstream### ecoho-core-MCenter-28080
upstream ecoho-core-MCenter-28080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:28087;
} 
###Upstream### ecoho-core-MCenter-8080
upstream ecoho-core-MCenter-8080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:8087;
} 
###Upstream### ecoho-core-Nginx-443
upstream ecoho-core-Nginx-443 {
	ip_hash;
    least_conn;
	server 172.18.213.214:443;
} 
###Upstream### ecoho-core-Nginx-80
upstream ecoho-core-Nginx-80 {
	ip_hash;
    least_conn;
	server 172.18.213.214:80;
} 
###Upstream### ecoho-core-UCenter-28080
upstream ecoho-core-UCenter-28080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:28081;
} 
###Upstream### ecoho-core-UCenter-8080
upstream ecoho-core-UCenter-8080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:8081;
} 
###Upstream### ecoho-port-GateKeeper-28080
upstream ecoho-port-GateKeeper-28080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:28100;
} 
###Upstream### ecoho-port-GateKeeper-8080
upstream ecoho-port-GateKeeper-8080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:8100;
} 
###Upstream### ecoho-port-GateKeeper-9090
upstream ecoho-port-GateKeeper-9090 {
	ip_hash;
    least_conn;
	server 172.18.213.214:32770;
} 
###Upstream### ecoho-port-Weixin-28080
upstream ecoho-port-Weixin-28080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:28090;
} 
###Upstream### ecoho-port-Weixin-8080
upstream ecoho-port-Weixin-8080 {
	ip_hash;
    least_conn;
	server 172.18.213.214:8090;
} 
###Upstream### ecoho-port-Weixin-9090
upstream ecoho-port-Weixin-9090 {
	ip_hash;
    least_conn;
	server 172.18.213.214:9090;
} 
###Upstream### ecoho-web-prop
upstream ecoho-web-prop {
	ip_hash;
    least_conn;
	server 106.75.137.105:8105;
}                                   


#===========================================================
#========== Service in DataCenter(core.ecoho.cn) ===========
#===========================================================
server {
    listen       80;
    server_name  core.ecoho.cn;

    #========== Settings ==========
    default_type 'text/html';
    charset utf-8;
	
	#========== Proxy ===========
    proxy_redirect  off;
    proxy_set_header    Host            $host:$server_port;
    proxy_set_header    X-Real-IP       $remote_addr;
    proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;

	#========== Proxy ===========
    valid_referers none blocked *.ecoho.cn;
    if ($invalid_referer) {
        return 403;
    }
	
	#========== Favicon ===========
    location = /favicon.ico {
        log_not_found  off;
        root    /var/www/home;
    }
	
	#========== Services ===========
  
	###Service### ecoho-core-MCenter-8080
	location ^~ /mcenter
	{
        proxy_pass      http://ecoho-core-MCenter-8080;
	}
  
	###Service### ecoho-core-UCenter-8080
	location ^~ /ucenter
	{
        proxy_pass      http://ecoho-core-UCenter-8080;
	}
  
	###Service### ecoho-port-GateKeeper-8080
	location ^~ /gatekeeper
	{
        proxy_pass      http://ecoho-port-GateKeeper-8080;
	}
  
	###Service### ecoho-port-Weixin-8080
	location ^~ /weixin
	{
        proxy_pass      http://ecoho-port-Weixin-8080;
	}


	###Service### ecoho-port-Weixin-9090
	location ^~ /wxserver
	{
        proxy_pass      http://ecoho-port-Weixin-9090;
	}


	#========== Log ========== 
    #access_log /etc/nginx/log/core.ecoho.cn.access.log main;
	
	#log_format syslog '$remote_addr|$host|$request_uri|$status|$request_time|$body_bytes_sent|'
	#                  '$upstream_addr|$upstream_status|$upstream_response_time|'
	#                  '$http_referrer|$http_add_x_forwarded_for|$http_user_agent';    
	
	#   access_log     /data/nginx/log/api-orange-com-access.log syslog;
	#   error_log      /data/nginx/log/api-orange-com-error.log debug;
}



